<?xml version="1.0"?>
<scxml xmlns="http://www.w3.org/2005/07/scxml" xmlns:vxml="http://www.w3.org/2001/vxml" version="1.0" initial="Start">
    <datamodel>
          <data id="Grammar" expr="./registrace.grxml"/>
    </datamodel>  
    <state id="Start">
          <onentry>
              <vxml:prompt>Vítejte v registraci předmětů</vxml:prompt>
          </onentry>
          <onexit>
              <vxml:assign name="Start" expr="true"/>
          </onexit>
          <transition event="All" target="All" />
          <transition event="Course" target="Finishing" />
          <transition event="Finishing" target="Course" />
    </state>
    <state id="Finishing">
          <onentry>
              <vxml:prompt>Zadejte způsob ukončení.</vxml:prompt>
              <vxml:prompt count="2">Možnosti jsou zkouška nebo zápočet.</vxml:prompt>
          </onentry>
          <datamodel>
            <data id="Finishing">
                <rule id="ukonceni">
                    <one-of>
                        <item tag="zkouska">
                            <ruleref uri="#zkouska"/>
                        </item>
                        <item tag="zapocet">
                            <ruleref uri="#zapocet"/>
                        </item>
                    </one-of>
                </rule>
                <rule id="zkouska">
                    <one-of>
                        <item>zkouskou</item>
                        <item>zkousku</item>
                        <item>zkouska</item>
                    </one-of>
                </rule>
                <rule id="zapocet">
                    <one-of>
                        <item>zapoctem</item>
                        <item>zapocet</item>
                    </one-of>
                </rule>
            </data>
          </datamodel>
          <transition event="Finishing" target="All"/>
    </state>
    <state id="Course">
          <onentry>
              <vxml:prompt>Zadejte registrovaný předmět.</vxml:prompt>

              <vxml:prompt count="2">Lze si zaregistrovat předměty PB095, PB125, PB162 nebo PA156.</vxml:prompt>
          </onentry>
          <datamodel>
           <data id="Course">
               <rule id="predmet">
                   <one-of>
                       <item>pb095<tag>{$.predmet = 'pb095';}</tag></item>
                       <item>pb125<tag>{$.predmet = 'pb125';}</tag></item>
                       <item>pb162<tag>{$.predmet = 'pb162';}</tag></item>
                       <item>pa156<tag>{$.predmet = 'pa156';}</tag></item>
                   </one-of>
               </rule>
           </data>
          </datamodel>
          <transition event="Course" target="All"/>
    </state>
    <state id="All">
          <onentry>
              <vxml:prompt>Zadal jste <vxml:value expr="Course"/>, ukončený <vxml:value expr="Finishing"/>. Souhlasíte?</vxml:prompt>
              <vxml:prompt count="2">Ano nebo ne?</vxml:prompt>
          </onentry>
          <datamodel>
           <data id="yesno" expr="./registration.grxml#anone"/>
          </datamodel>
          <transition event="ne" target="Start" />
          <transition event="ano" target="Submit" />
    </state>
    <final id="Submit">
      <onentry>
        <vxml:submit src="uri" namelist="Course Finishing"/>
      </onentry>
    </final>
</scxml>
